
https://youtu.be/oFG2MFyHTgQ?t=306
Prosemirror

https://youtu.be/oFG2MFyHTgQ?t=424
основы prosemirror: state - модель в памяти
view - представление: отвечает за обработку событий от пользователя и за отображение содержимого модели
schema - набор объектов, которые могут пристуствовать на нашем редакторе

https://youtu.be/oFG2MFyHTgQ?t=481
MVC
 
https://youtu.be/oFG2MFyHTgQ?t=515
создание editorview
в объекте настроек только state

Alex, [28.11.20 10:19]
[ Photo ]
тут addToEnd имеет какой то смысл в контексте необхоидмости следовать какому то порядку этих узлов, или ты просто добавляешь тип нода в коллекцию типов нода схемы с помощью такой функции?

Олег Белохохлов, [28.11.20 10:20]
скорее всего, нет. Просто почету для хранения информации prosemirror использует orderedMap

https://youtu.be/oFG2MFyHTgQ?t=554
плагины Prosemirror, реаг на события и меняют содерж модели
inputRules (регуляркой заменять какую то строку на какой то элемнет), keymap (базовые хоткеи)

#question что дает использование подключенного markdown (кеимапы например какие)

https://youtu.be/oFG2MFyHTgQ?t=635
что такое модель - в модели хранится документ, это некий корневой узел дерева, в нем могут хранится узлы другие (простые текстовые = листья, либо продвинутые - наша ссылка). ссылка внутри себя может хранить еще элементы
input rules могут заменить кусок обычного plain текста на какой то узел (по регулярке)

>Alex, [28.11.20 10:27]
ты сказал , что простые текстовые узлы - это листья. ты сам эту формирулировку придумал?
Alex, [28.11.20 10:28]
или это есть в доке?
Олег Белохохлов, [28.11.20 10:28]
у узлов есть свойство leaf
Олег Белохохлов, [28.11.20 10:28]
это из доки

понятие mark https://youtu.be/oFG2MFyHTgQ?t=683

Alex, [28.11.20 10:30]
input rules могут заменить кусок обычного plain текста на какой то узел (по регулярке) - вопрос: правильно ли понял, что в рамках документа (который хранится в модели) могут быть  как узлы (в том числе leafs или более сложные), так и просто plain текст?

Alex, [28.11.20 10:30]
который не принадлелжит конкретному узлу

>Олег Белохохлов, [28.11.20 10:30]
plain text является текстовым узлом
Alex, [28.11.20 10:31]
то есть leaf = plain text?
Олег Белохохлов, [28.11.20 10:31]
не обязательно
Олег Белохохлов, [28.11.20 10:31]
листом может также быть нода, не допускающая изменения своего контента
Олег Белохохлов, [28.11.20 10:31]
например картинка
Alex, [28.11.20 10:32]
ок иначе говоря - plain text - это подмножество leaf?
да

https://youtu.be/oFG2MFyHTgQ?t=697
marc  - поверх текста (который тоже счиается примитивным узлом) или поверх других узлов, которая делает нечто близкое, но другое
может быть произвольная древовидная структура
объект doc из state, если вызывать по нему foreach - вернуть все узлы https://youtu.be/oFG2MFyHTgQ?t=751
console.log(view.state)

https://youtu.be/oFG2MFyHTgQ?t=778
разница между марками и узлами
марка - набор свойств, которые присваиваются тексту
но он не может нормально добавлять html элементы в структуру
он может только оборачивать в какой то тег сущствующие текстовые элементы или узлы
марка позволяет повесить css флаг на кусок текста
но марка не может вокруг какого то куска текста отображать какие то символы

https://youtu.be/oFG2MFyHTgQ?t=915
как взаимодействует марка с нодой
может быть присвоена части

https://youtu.be/oFG2MFyHTgQ?t=941
handleTextInput
https://youtu.be/oFG2MFyHTgQ?t=1043
поиск родителських узлов для позицией курсора


![[Pasted image 20201128165929.png]]
#question 
let viewToGlobalContext = null

https://youtu.be/oFG2MFyHTgQ?t=1189
проход по всем нодам

https://youtu.be/oFG2MFyHTgQ?t=1327
replaceWithNodeInputRule
tr - транзакция

https://youtu.be/oFG2MFyHTgQ?t=1472
наполнение схемы набором объектов
отображение или неотобьражение (выключение)
схема - список узлов и марок, которые могу находиться в конкретном документе

https://youtu.be/oFG2MFyHTgQ?t=1541
нолик - то место куда надо помещать все дочерние узлы конкретно го документа 

#insight я понял, по ходу всегда показывается все, просто окружающее может показываться с нулевой прозрачностью и размером

создание базовой ссылки, которая нужна для тестов
https://youtu.be/oFG2MFyHTgQ?t=1752

рекомендации по созданию bold https://youtu.be/oFG2MFyHTgQ?t=1811

link - сам кликабельная ссылка https://youtu.be/oFG2MFyHTgQ?t=1574

>Alex, [29.11.20 09:31]
[In reply to Олег Белохохлов]
нолик это какой то индекс элемнета в модели?
Олег Белохохлов, [29.11.20 09:31]
[In reply to Alex]
нет, они просто так решили назвать этот объект. Фактически, это слот, куда надо помещать дочерние узлы


>вот тут чуть неясна так строка где instanceof и потом как эти атрибуты влияют на link (где title) и hiddenlink (где href)
Олег Белохохлов, [29.11.20 09:32]
[In reply to Alex]
[ Photo ]
getAttrs передается как лямбда функция здесь: http://joxi.ru/YmE1WgwswXXDXm
Олег Белохохлов, [29.11.20 09:33]
дальше если элемент, который был передан в этот аргумент является функцией, то она исполняется
Олег Белохохлов, [29.11.20 09:33]
и потом ее результат будет помещен в node.attrs у link

const attrs = getAttrs instanceof Function ? getAttrs(match) : getAttrs
если getAttrs это инстанс функции, атрибуты ей заполняются

findParentNodeOfType(mySchema.nodes.linkContainer)(view.state.selection)
вернуть функцию и вызвать ее с параметром во вторых скобках

const replaceWithNodeInputRule = (regexp: RegExp, markType: NodeType, getAttrs? : Function) => {
  const newRegexp = new RegExp(regexp.source.replace(/\$$/, '') + '(.)' + '$')
  Олег Белохохлов, [29.11.20 17:18]
я так понимаю, оно немного преобразует регулярку, которую туда человека передает

Олег Белохохлов, [29.11.20 17:18]
заменяет регулярку abc$ на abc(.)$

Alex, [29.11.20 17:19]
а что это нам дает? иначе говоря - для чего ты это использованл

Олег Белохохлов, [29.11.20 17:20]
эта реализация была взята с форума prosemirror, скорее всего это нужно для того, чтобы inputRule исполнялся не сразу, как только регулярка нашлась, а когда после нее появился еще 1 символ

использвоание схема маркдауна пока ничего не исопльзуем, но заголовки и еще что нибудь возможно

юзер считает, что курсор формально здесь http://joxi.ru/xAeNny4uRyyP3r

view.dispatch - применить транзакацию

https://prosemirror.net/docs/guide/ #todo 

https://www.youtube.com/watch?v=JQ9KWG1E0WU

Лог позиций. Prosemirror
https://www.evernote.com/l/AeAbPo_bP4xOlLvAyrbCOSworftN9NQ9864/

[[prosemirror]]